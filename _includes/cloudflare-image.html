{% comment %}
  Cloudflare Images Integration Helper

  Usage:
  {% include cloudflare-image.html
     src="image-id-or-path"
     alt="Alt text"
     sizes="(max-width: 768px) 100vw, 50vw"
     loading="lazy"
     class="custom-class"
     data-full="full-res-url"
  %}
{% endcomment %}

{% assign cf_base = site.cloudflare.images_url %}
{% assign cf_account = site.cloudflare.account_hash %}

{% comment %} Build the Cloudflare Images URL with flexible variants {% endcomment %}
{% if include.src contains "http" %}
  {% assign image_url = include.src %}
{% else %}
  {% comment %} With flexible variants, use width parameters for responsive images {% endcomment %}
  {% assign base_url = cf_base | append: "/" | append: cf_account | append: "/" | append: include.src %}
  {% assign image_url = base_url | append: "/public" %}
{% endif %}

{% comment %} Generate responsive image URLs using flexible variants {% endcomment %}
{% assign image_small = base_url | append: "/w=480" %}
{% assign image_medium = base_url | append: "/w=768" %}
{% assign image_large = base_url | append: "/w=1200" %}

<picture>
  <source
    media="(max-width: 480px)"
    srcset="{{ image_small }}"
  >
  <source
    media="(max-width: 768px)"
    srcset="{{ image_medium }}"
  >
  <source
    media="(min-width: 769px)"
    srcset="{{ image_large }}"
  >
  <img
    src="{{ image_medium }}"
    alt="{{ include.alt | default: 'Barnes Family Photo' }}"
    loading="{{ include.loading | default: 'lazy' }}"
    {% if include.sizes %}sizes="{{ include.sizes }}"{% endif %}
    {% if include.class %}class="{{ include.class }}"{% endif %}
    {% if include.data-full %}data-full="{{ include.data-full }}"{% endif %}
  >
</picture>